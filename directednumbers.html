<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Number Line Bounce Game with Target Grid and AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #instructions {
            width: 80%;
            margin: 20px auto;
            font-size: 18px;
        }
        #numberLineContainer {
            width: 80%;
            margin: 20px auto;
            position: relative;
            height: 100px;
        }
        #numberLine {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #000;
        }
        .number {
            position: absolute;
            bottom: 0;
            transform: translateX(-50%);
            text-align: center;
            width: 40px;
        }
        .marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            position: absolute;
            top: 10px;
            transform: translateX(-50%);
            transition: left 0.5s ease-in-out;
        }
        #player1 {
            background-color: red;
        }
        #player2 {
            background-color: blue;
        }
        #dice {
            margin-top: 20px;
            text-align: center;
        }
        .dice {
            font-size: 24px;
            display: inline-block;
            margin: 0 10px;
            cursor: pointer;
            width: 80px;
            height: 100px;
            line-height: 70px;
            text-align: center;
            border: 2px solid black;
            border-radius: 10px;
            position: relative;
            vertical-align: top;
        }
        #dice1 {
            background-color: lightgreen;
        }
        #dice2 {
            background-color: lightcoral;
        }
        .dice-value {
            font-size: 50px;
            margin-top: 10px;
        }
        .dice-direction {
            font-size: 16px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #targetNumber {
            font-size: 24px;
            margin-top: 20px;
            text-align: center;
        }
        #currentPlayerDisplay {
            font-weight: bold;
        }
        #gridContainer {
            width: 300px;
            margin: 20px auto;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 5px;
        }
        .grid-cell {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid black;
            width: 50px;
            height: 50px;
            font-size: 20px;
        }
        .highlight {
            background-color: yellow;
        }
        .past-highlight {
            background-color: lightgray;
        }
        .player1-text {
            color: red;
        }
        .player2-text {
            color: blue;
        }
        #winnerTally {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Number Line Bounce Game with Target Grid and AI</h1>
    <div id="instructions">
        <p>Welcome to the enhanced Number Line Bounce Game!</p>
        <p><strong>Instructions:</strong></p>
        <ul>
            <li>The goal is to reach the target number displayed below.</li>
            <li>Players take turns rolling two colored dice.</li>
            <li>On your turn, click on one die to move your marker:</li>
            <ul>
                <li><span style="color: green;">Green Die (→ Forward):</span> Move forward by the number shown.</li>
                <li><span style="color: red;">Red Die (← Backward):</span> Move backward by the number shown.</li>
            </ul>
            <li>The first player to reach the target number wins!</li>
        </ul>
        <button onclick="startNewRound()">Start New Game</button>
        <label>
            <input type="checkbox" id="playVsComputer" /> Play vs Computer
        </label>
    </div>
    <div id="gridContainer">
        <!-- Target grid will be generated by JavaScript -->
    </div>
    <div id="targetNumber">Target Number: <span id="target"></span></div>
    <div id="numberLineContainer">
        <div id="numberLine"></div>
        <!-- Number line will be generated by JavaScript -->
    </div>
    <div id="dice">
        <button onclick="rollDice()">Roll Dice</button>
        <p>Current Player: <span id="currentPlayerDisplay" class="player1-text">Player 1</span></p>
        <div>
            <div id="dice1" class="dice" onclick="chooseDice(1)">
                <div class="dice-value"></div>
                <div class="dice-direction">→ Forward</div>
            </div>
            <div id="dice2" class="dice" onclick="chooseDice(2)">
                <div class="dice-value"></div>
                <div class="dice-direction">← Backward</div>
            </div>
        </div>
    </div>
    <div id="winnerTally">
        <p>Player 1 Wins: <span id="player1Wins">0</span> | Player 2 Wins: <span id="player2Wins">0</span></p>
    </div>

    <script>
        const gridNumbers = [
            -7, -3, 11, 5, -10, 
            10, -2, -5, 12, 6, 
            8, -8, -6, 4, 9, 
            0, -9, -11, -1, 3, 
            7, -4, 2, 1, -12
        ];
        const numberLineLength = 33; // From -16 to +16
        let player1Position = 16; // Start at 0 (index 16)
        let player2Position = 16; // Start at 0 (index 16)
        let currentPlayer = 1;
        let targetNumber;
        let dice1Value = 0;
        let dice2Value = 0;
        let gameOver = false;
        let player1Wins = 0;
        let player2Wins = 0;
        let highlightedCell = null;
        let playVsComputer = false;
        let pastTargets = [];

        const gridContainer = document.getElementById('gridContainer');
        document.getElementById('playVsComputer').addEventListener('change', function() {
            playVsComputer = this.checked;
        });

        // Generate the target number grid
        gridNumbers.forEach((num, index) => {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            cell.id = 'cell-' + index;
            cell.textContent = num;
            gridContainer.appendChild(cell);
        });

        function startNewRound() {
            gameOver = false;
            // Choose a random target number from the grid
            const randomIndex = Math.floor(Math.random() * gridNumbers.length);
            targetNumber = gridNumbers[randomIndex];
            document.getElementById('target').textContent = targetNumber;

            // Keep track of past target numbers
            if (highlightedCell) {
                highlightedCell.classList.remove('highlight');
                highlightedCell.classList.add('past-highlight');
                pastTargets.push(highlightedCell);
            }

            // Highlight the new target number
            highlightedCell = document.getElementById('cell-' + randomIndex);
            highlightedCell.classList.add('highlight');
        }

        // Generate the number line
        const numberLineContainer = document.getElementById('numberLineContainer');
        let numberLine = [];
        for (let i = -16; i <= 16; i++) {
            let numberDiv = document.createElement('div');
            numberDiv.className = 'number';
            numberDiv.textContent = i;
            numberDiv.id = 'number-' + (i + 16); // Adjust index to start from 0
            let positionPercent = ((i + 16) / (numberLineLength - 1)) * 100;
            numberDiv.style.left = positionPercent + '%';
            numberLineContainer.appendChild(numberDiv);
            numberLine.push(numberDiv);
        }

        // Place player markers
        let player1Marker = document.createElement('div');
        player1Marker.id = 'player1';
        player1Marker.className = 'marker';
        player1Marker.style.left = ((player1Position / (numberLineLength - 1)) * 100) + '%';
        numberLineContainer.appendChild(player1Marker);

        let player2Marker = document.createElement('div');
        player2Marker.id = 'player2';
        player2Marker.className = 'marker';
        player2Marker.style.left = ((player2Position / (numberLineLength - 1)) * 100) + '%';
        numberLineContainer.appendChild(player2Marker);

        function rollDice() {
            if (gameOver) return;
            dice1Value = Math.floor(Math.random() * 6) + 1;
            dice2Value = Math.floor(Math.random() * 6) + 1;
            displayDice();
            if (playVsComputer && currentPlayer === 2) {
                setTimeout(() => {
                    chooseDice(Math.random() < 0.5 ? 1 : 2); // AI chooses a random dice
                }, 1000);
            } else {
                alert('Player ' + currentPlayer + ', choose a die to move.');
            }
        }

        function displayDice() {
            document.querySelector('#dice1 .dice-value').textContent = dice1Value;
            document.querySelector('#dice2 .dice-value').textContent = dice2Value;
        }

        function chooseDice(diceNumber) {
            if (dice1Value === 0 || dice2Value === 0) {
                alert('Please roll the dice first!');
                return;
            }
            let moveValue;
            if (diceNumber === 1) {
                moveValue = dice1Value;
            } else if (diceNumber === 2) {
                moveValue = -dice2Value;
            } else {
                alert('Invalid dice selection.');
                return;
            }

            if (currentPlayer === 1) {
                movePlayer(1, moveValue);
                currentPlayer = 2;
                document.getElementById('currentPlayerDisplay').textContent = 'Player 2';
                document.getElementById('currentPlayerDisplay').classList.remove('player1-text');
                document.getElementById('currentPlayerDisplay').classList.add('player2-text');
            } else {
                movePlayer(2, moveValue);
                currentPlayer = 1;
                document.getElementById('currentPlayerDisplay').textContent = 'Player 1';
                document.getElementById('currentPlayerDisplay').classList.remove('player2-text');
                document.getElementById('currentPlayerDisplay').classList.add('player1-text');
            }
            dice1Value = 0;
            dice2Value = 0;
            document.querySelector('#dice1 .dice-value').textContent = '';
            document.querySelector('#dice2 .dice-value').textContent = '';
        }

        function movePlayer(player, move) {
            if (player === 1) {
                let newPos = updatePosition(player1Position, move);
                player1Marker.style.left = ((newPos / (numberLineLength - 1)) * 100) + '%';
                player1Position = newPos;
                checkWin(player1Position - 16, 1);
            } else {
                let newPos = updatePosition(player2Position, move);
                player2Marker.style.left = ((newPos / (numberLineLength - 1)) * 100) + '%';
                player2Position = newPos;
                checkWin(player2Position - 16, 2);
            }
        }

        function updatePosition(position, move) {
            let newPos = position + move;
            if (newPos < 0) newPos = 0;
            if (newPos >= numberLineLength) newPos = numberLineLength - 1;
            return newPos;
        }

        function checkWin(position, player) {
            if (position === targetNumber) {
                alert('Player ' + player + ' wins!');
                if (player === 1) {
                    player1Wins++;
                    document.getElementById('player1Wins').textContent = player1Wins;
                } else {
                    player2Wins++;
                    document.getElementById('player2Wins').textContent = player2Wins;
                }
                gameOver = true;
                startNewRound(); // Select new target number and continue the game
            }
        }

        // Start the first round
        startNewRound();
    </script>
</body>
    <footer>
        <p>Created by cliffpackman@gmail.com adapted based on Grade 6 Boaler's developing mathematical mindsets on 28/9/2024</p>
    </footer>
</html>
